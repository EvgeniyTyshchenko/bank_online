### Данный проект предназначен для менеджеров банка с целью закрытия основных потребностей клиента.

В проекте моделируются некоторые банковские операции.

Описание функционала:

### Клиент:
1. **Регистрация клиента в банке.** 
Проверка на дублирование паспортных данных, отправка электронного письма с уведомлением, далее, добавление клиента в базу данных банка.

2. **Поиск клиента по серии и номеру паспорта.**

3. **Закрытие(удаление) клиента.**
Производятся проверки: 1) зарегистрирован ли клиент фактически в данном банке; 2) не заблокирован ли клиент и не закрыт; 4) производится 
поиск всех открытых карт и сберегательных счетов(СС) принадлежащих клиенту, если на картах или СС 
имеется баланс > 0, то менеджер банка не сможет закрыть аккаунт клиента, т.к. клиент должен снять все денежные средства с карт и/или
СС, если же на картах и СС баланс = 0, то автоматически производится закрытие всех карт, СС и 
аккаунт клиента закрывается (важно отметить, что для клиента производится закрытие, НО для банка клиент остается в базе, изменяется 
только его статус, следовательно, если статус у клиента CLOSED, то ни одной операции невозможно произвести с данным клиентом).
Клиенты остаются в базе навсегда, для формирования общей базы работающих/работавших с данным банком.

4. **Редактирование клиента.**
В данном функционале принимаются параметры серия, номер паспорта и объект, на который нам нужно изменить информацию.
Предусмотрена ситуация, где менеджер банка при редактировании паспортных данных клиента может повторно допустить ошибку и ввести серию и номер паспорта клиента,
который уже зарегистрирован в банке.

5. **Получить клиента по номеру карты.**
6. **Получить клиента по номеру сберегательного счета.**


### Карта:
1. **Открытие карты.** 
Менеджер банка может оформить открытие карты, где аналогично производятся проверки: 1) зарегистрирован ли клиент в банке; 2) не заблокирован 
или закрыт клиент; 
Реализуется формирование карты: присваивается номер карты, номер счета, CVV, баланс, валюта(RUB), статус, дата открытия, дата изменений. Клиенту на почту приходит письмо 
со всей информацией по карте и дальнейшим действиям по её получении и активации.

2. **Закрытие карты.**
Аналогично производятся проверки по регистрации клиента, его статусу. Проверяется карта на то, что она активна (не заблокирована и не закрыта), что ее баланс = 0,
после чего происходит закрытие карты и клиент получает уведомление на почту.

3. **Заблокировать карту.**
При возможной краже или утери карты, имеется возможность заблокировать карту. Также производятся проверки на регистрацию клиента в банке, на его статус 
и на принадлежность указанной карты клиенту. Если карта принадлежит клиенту, то проверяется ее статус, после чего производится блокировка.

4. **Разблокировка карты.**
При каких-либо обстоятельствах, если клиент запрашивает разблокировать карту, то производится аналогичный процесс с проверками и карта разблокируется.

5. **Запрос баланса.**
Производятся аналогичные проверки и предоставляется баланс карты.

6. **Запрос на получение информации по карте.**
Производятся проверки и если все условия соответствуют, предоставляется информация карты.


### Сберегательный счет:

**_Важно!!!_** Менеджер банка должен проинформировать клиента по условиям СС. Ставка 5% годовых, срок 1 месяц. Т.е. клиент открывает СС, на котором по умолчанию баланс = 0, далее,
клиент имеет возможность разово пополнить СС на любую сумму, после чего по прошествию 1 месяца будет автоматически начислен процент на данный СС.

1. **Открытие сберегательного счета.**
Производятся проверки по аналогии с картой, далее, открывается СС, где присваивается номер счета, баланс, валюта(RUB), дата открытия, дата изменений.

2. **Закрытие сберегательного счета.**
Реализуются аналогичные проверки, далее, производится проверка баланса, если баланс не равен 0, то клиент получает денежные средства в кассе и СС закрывается.

3. **Запрос баланса.**
Проверки, далее, вывод баланса.


### Денежные переводы:
1. **Перевод денежных средств между картами клиентов.**
   Производятся проверки для отправителя + проверка на допустимость совершения транзакции(т.е. баланс карты должен соответствовать отправляемой сумме), а также производятся проверки клиента-получателя и его карты, если все условия проходят, то совершается перевод денежных средств.

2. **Зачисление денежных средств на СС через кассу банка.**
   Реализуются проверки + проверяется условие вклада (вклад может быть пополнен 1 раз), далее, зачисление денежных средств.

3. **Перевод денежных средств между картой и СС.**
   Производятся аналогичные проверки как отправителя, так и получателя, далее, реализуется перевод.

4. **Перевод денежных средств между сберегательными счетами.**
   Проверки, перевод денежных средств.

   
### Адрес:
1. **Получение всех адресов.**
2. **Редактирование адреса клиента.**

### Контакты:
1. **Получение всех контактов.**
2. **Редактирование контактных данных клиента.**

### Транзакции:

**_ВАЖНО!!!_** Весь выше описанный функционал сопровождается формированием транзакций, т.е. при любом использовании функционала формируется история выполнения, например, если клиент 
зарегистрировался, то формируется транзакция(кто зарегистрировался, тип транзакции, когда зарегистрировался и т.д.), если клиент переводит денежные средства, другому клиенту банка,
то формируется транзакция у клиента отправителя (где указана вся информация с какого счета были отправлены деньги и на какой счет деньги поступили, сумма, валюта, тип транзакции,
дата и время совершения операции) и клиента получателя. 

1. **Запрос выгрузки всех транзакций по указанному клиенту.**
Данный функционал помогает проследить все производимые операции данным клиентом.


### Используемые технологии:
- Java 17
- Spring Boot, Spring Data JPA
- Mail Sending
- Task scheduler
- PostgreSQL
- H2
- Liquibase
- Junit5
- Mockito
- Postman / Swagger
- SonarQube
- Git
- Maven

### Шаги по настройке:
1. Клонируйте приложение;
2. Создайте базу данных PostgreSQL:
   create database bank_online;
3. Измените имя пользователя и пароль PostgreSQL в соответствии с вашей установкой:
откройте src/main/resources/application.properties, измените spring.datasource.username и spring.datasource.password в соответствии с Вашими параметрами;
4. Для корректной работы почты, в application.properties так же укажите параметры spring.mail;
5. Запустите проект;

Приложение начнет работать по адресу http://localhost:8080

### CRUD API:

**_Сustomers_**

| №   | Метод   | URL-адрес                                         | Описание                                                                                                        |
|-----|---------|---------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| 1   | GET     | /customers/series/{series}/number/{number}        | Получить клиента по серии и номеру паспорта                                                                     |
| 2   | POST    | /customers/add                                    | Регистрация/добавление нового клиента в базу данных банка                                                       |
| 3   | PATCH   | /customers/update/series/{series}/number/{number} | Обновление клиента (частичное)                                                                                  |
| 4   | PATCH   | /customers/close/series/{series}/number/{number}  | Закрытие учетной записи клиента по серии и номеру паспорта (клиент из базы не удаляется, изменяется его статус) |
| 5   | GET     | /customers/cardNumber/{cardNumber}                | Получить клиента по номеру карты                                                                                |
| 6   | GET     | /customers/accountNumber/{accountNumber}          | Получить клиента по номеру сберегательного счета                                                                |

_Образцы запросов:_

1. GET: http://localhost:8080/customers/series/1111/number/222333
2. POST: http://localhost:8080/customers/add
```json
{
    "passportSeries": 1111,
    "passportNumber": 222333,
    "lastName": "Петров",
    "firstName": "Петр",
    "patronymic": "Петрович",
    "birthday": "01.01.1960",
    "addressDTO": {
        "country": "Россия",
        "city": "Москва",
        "street": "Московская",
        "house": "17/Б",
        "apartment": 341
    },
    "contactDTO": {
        "phoneNumber": "89881231212",
        "email": "petrov1960@mail.ru"
    }
}
```
3. PATCH: http://localhost:8080/customers/update/series/1111/number/222333
```json
{
   "passportSeries": 1111,
   "passportNumber": 222333,
   "lastName": "Романенко",
   "firstName": "Петр",
   "patronymic": "Петрович",
   "birthday": "01.01.1960"
}
```
4. PATCH: http://localhost:8080/customers/close/series/1234/number/567890
5. GET: http://localhost:8080/customers/cardNumber/6002843000990046
6. GET: http://localhost:8080/customers/accountNumber/73057040010000413008



**_Сards_**

| №   | Метод  | URL-адрес                                                        | Описание                       |
|-----|--------|------------------------------------------------------------------|--------------------------------|
| 1   | POST   | /cards/series/{series}/number/{number}                           | Выпустить новую карту клиенту  |
| 2   | PATCH  | /cards/series/{series}/number/{number}/close/{cardNumber}        | Закрыть карту клиента          |
| 3   | PATCH  | /cards/series/{series}/number/{number}/block/{cardNumber}        | Блокировать карту              |
| 4   | PATCH  | /cards/series/{series}/number/{number}/unlock/{cardNumber}       | Разблокировать карту           |
| 5   | GET    | /cards/series/{series}/number/{number}/checkBalance/{cardNumber} | Проверить баланс карты         |
| 6   | GET    | /cards/details/{series}/{number}/{cardNumber}                    | Получить информацию по карте   |

_Образцы запросов:_
1. POST: http://localhost:8080/cards/series/1111/number/222333
2. PATCH: http://localhost:8080/cards/series/1111/number/222333/close/7002843000990046
3. PATCH: http://localhost:8080/cards/series/1111/number/222333/block/7577200902812046
4. PATCH: http://localhost:8080/cards/series/1111/number/222333/unlock/7577200902812046
5. GET: http://localhost:8080/cards/series/1111/number/222333/checkBalance/8090862007120042
6. GET: http://localhost:8080/cards/details/1111/222333/5900707403040047



**_Savings accounts_**

| №  | Метод  | URL-адрес                                                                                  | Описание                                                   |
|----|--------|--------------------------------------------------------------------------------------------|------------------------------------------------------------|
| 1  | POST   | /savingsAccounts/series/{series}/number/{number}                                           | Открыть сберегательный счет клиенту                        |
| 2  | PATCH  | /savingsAccounts/series/{series}/number/{number}/close/{accountNumber}                     | Закрыть сберегательный счет                                |
| 3  | GET    | /savingsAccounts/series/{series}/number/{number}/checkBalance/{accountNumber}              | Проверить баланс сберегательного счета                     |

_Образцы запросов:_
1. POST: http://localhost:8080/savingsAccounts/series/5555/number/444666
2. PATCH: http://localhost:8080/savingsAccounts/series/5555/number/444666/close/20505034016000400609
3. GET: http://localhost:8080/savingsAccounts/series/5555/number/444666/checkBalance/37617670001000470500



**_Money transfers_**

| №   | Метод  | URL-адрес                                                                                                 | Описание                                                               |
|-----|--------|-----------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
| 1   | PATCH  | /moneyTransfers/cards/{series}/{number}/{senderCardNumber}/{recipientCardNumber}/{amount}                 | Перевод между картами клиентов                                         |
| 2   | PATCH  | /moneyTransfers/{series}/{number}/{accountNumber}/{amount}                                                | Зачисление денежных средств на сберегательный счет (через кассу банка) |
| 3   | PATCH  | /moneyTransfers/{series}/{number}/sender/{cardNumber}/recipient/{accountNumber}/{amount}                  | Перевод денежных средств между картой и сберегательным счетом          |
| 4   | PATCH  | /moneyTransfers/savingsAccounts/{series}/{number}/{senderAccountNumber}/{recipientAccountNumber}/{amount} | Перевод денежных средств между сберегательными счетами                 |

_Образцы запросов:_
1. PATCH: http://localhost:8080/moneyTransfers/cards/1111/222333/5900707403040047/5650990100940044/13000
2. PATCH: http://localhost:8080/moneyTransfers/5555/444666/37617670001000470500/70000
3. PATCH: http://localhost:8080/moneyTransfers/1111/222333/sender/5900707403040047/recipient/56063400028410410009/50000
4. PATCH: http://localhost:8080/moneyTransfers/savingsAccounts/1111/222333/53052007005000400000/50000793005200470509/35000


**_Addresses_**

| №   | Метод | URL-адрес                                  | Описание                     |
|-----|-------|--------------------------------------------|------------------------------|
| 1   | GET   | /addresses/getAll                          | Получить все адреса клиентов |
| 2   | PUT   | /addresses/series/{series}/number/{number} | Обновить адрес клиента       |

_Образцы запросов:_
1. GET: http://localhost:8080/addresses/getAll
2. PUT: http://localhost:8080/addresses/series/1111/number/222333
```json
{
   "country": "Россия",
   "city": "Москва",
   "street": "Российская",
   "house": "254/2",
   "apartment": 561
}
```

**_Contacts_**

| №   | Метод | URL-адрес                                 | Описание                                |
|-----|-------|-------------------------------------------|-----------------------------------------|
| 1   | GET   | /contacts/getAll                          | Получить все контактные данные клиентов |
| 2   | PUT   | /contacts/series/{series}/number/{number} | Обновить контактную информацию клиента  |

_Образцы запросов:_
1. GET: http://localhost:8080/contacts/getAll
2. PUT: http://localhost:8080/contacts/series/1111/number/222333
```json
{
   "phoneNumber": "89058889080",
   "email": "email123@yandex.ru"
}
```
   
_**Transactions**_

| №   | Метод | URL-адрес                                     | Описание                    |
|-----|-------|-----------------------------------------------|-----------------------------|
| 1   | GET   | /transactions/series/{series}/number/{number} | Получить транзакции клиента |

_Образец запроса:_

GET: http://localhost:8080/transactions/series/1111/number/222333


### Общее покрытие проекта тестами: 91 %
![image](https://github.com/EvgeniyTyshchenko/bank_online_project/assets/113645139/3331bba8-decf-4001-95a1-852a5c43a667)
![image](https://github.com/EvgeniyTyshchenko/bank_online_project/assets/113645139/9fab2a3e-1fef-4847-9f6c-5571677169b2)

### Контроль качества кода производился с помощью SonarQube.
